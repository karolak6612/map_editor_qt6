**Task97: Integrate Application Settings and Preferences (Full Persistence & Application across all components)**
- Task: **Migrate and complete all remaining `SettingsManager`/`g_settings` features from `wxwidgets`. This involves ensuring that *all* configurable application settings (UI state, editor defaults, paths, rendering options, automagic behaviors, palette layouts, brush shapes/properties) are correctly saved on application exit and loaded/applied on startup, using a robust cross-platform solution in `project_qt` (likely `QSettings`).**
    - **Analyze `g_settings` from `wxwidgets`:** Identify ALL settings managed by `g_settings` (or equivalent configuration classes) in the original application. This includes their names (keys), data types, default values, and what parts of the application they affected.
    - **`QSettings` Implementation:**
        -   Establish a global or easily accessible `QSettings` object in `project_qt` (e.g., `QApplication::setOrganizationName()`, `setApplicationName()` then use default constructor).
        -   For each original setting, define a corresponding key in `QSettings`.
    - **Saving Settings:** On application shutdown (`MainWindow::closeEvent`), save the current value of all configurable settings to `QSettings`. This includes:
        -   Window positions/sizes, `QMainWindow` state (toolbar/dock positions - Task 62).
        -   Palette layouts, visibility of UI panels.
        -   Last used paths (maps, tilesets, etc.).
        -   Current state of `DrawingOptions` (Task 75) if these are user-configurable preferences.
        -   Default brush shapes, sizes, or properties if these were configurable and persistent.
        -   State of `Automagic` system toggles (Task 18).
        -   Any screen resolution or rendering backend choices if applicable.
    - **Loading & Applying Settings:** On application startup:
        -   Load all settings from `QSettings`. If a setting is not found, apply a sensible default value.
        -   Apply these loaded settings:
            -   Restore window/UI layout.
            -   Configure `DrawingOptions`, `BrushManager` defaults, `AutomagicBorderController`, etc.
            -   Ensure UI controls in `PreferencesWindow` (Task 78) correctly display the loaded settings.
    - **Data Format Conversions (`QVariant`):** Use `QVariant` correctly with `QSettings` for storing various data types (bools, ints, strings, QStringLists, byte arrays for complex structs if needed). If `wxwidgets` config used custom data formats, port the parsing.
    - **Updating Application on Setting Change:** When a setting is changed via `PreferencesWindow`:
        -   The new value must be saved to `QSettings` immediately (or on "Apply").
        -   The relevant part of the application must be notified and update its behavior/appearance accordingly (e.g., changing a rendering option should trigger `MapView::update()`). This usually involves the `PreferencesWindow` emitting signals that `MainWindow` or other managers connect to.
    - **Consistency:** Ensure default initial values for settings are consistently applied across all controls if no saved setting exists. This relates to original logic for default `Automagic`/brush tool states like `BORDER_XXX` (which might now be an `ItemProperty`).
    - **Custom Brush Settings:** If `QBrush` or other Qt drawing objects have properties that need to be configurable (e.g., a default "CustomBrush" color/pattern if the editor had named custom brushes for drawing specific borders), `QSettings` should store these.
    - **`Task97.md` is crucial: it must provide a comprehensive list of *all* settings from `wxwidgets g_settings` (or equivalent), their keys, data types, default values, sections they affected (UI, rendering, tools, paths), and where in the `wxwidgets` code they were read and applied. It should also detail any custom configuration file parsing if not using standard `wxConfig`.**
