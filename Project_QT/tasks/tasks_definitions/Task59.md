**Task59: Create `ItemFinder` / `TileFinder` utilities (Comprehensive Item/Tile Searching Logic)**
- Task: **Implement `TileFinder` and/or `ItemFinder` utility classes (or free functions within a namespace) in `project_qt`. These utilities will provide efficient and flexible methods for searching `Tile`s and `Item`s within the `Map` based on various criteria (e.g., item attributes, `ItemType`, ID from a `Brush`, specific flags). This replaces individualized `Tile->findXXXBrush()` or `Tile->hasXXXEquivalent()` methods from `wxwidgets` by providing a more centralized and powerful search mechanism.**
    - **Analyze Existing Search Logic:** Review how `wxwidgets` `Tile` class and map iteration functions (`findItems`, `foreach_*`) performed searches.
    - **`TileFinder` / `ItemFinder` Interface:**
        -   Define methods like:
            -   `QList<Tile*> TileFinder::findTilesWithItemProperty(Map* map, const QString& propertyKey, const QVariant& value, std::function<bool(Item*)> itemFilter = nullptr);`
            -   `QList<Item*> ItemFinder::findItemsOnTile(Tile* tile, ItemID_or_Type_or_Predicate criteria);`
            -   `QList<Item*> ItemFinder::findAllItemsInMap(Map* map, ItemID_or_Type_or_Predicate criteria);`
        -   The `criteria` could be specific item IDs, `ItemType`s (enum or string), a lambda predicate for custom attribute checks, or combinations thereof.
    - **Search Logic:**
        -   Implement efficient iteration over `Map`'s tiles and each `Tile`'s item list (`QVector<Item*>`).
        -   Use `Item`'s attribute map (`getAttribute()`) and `ItemType` information for filtering.
    - **Replacement for `find*Brush` methods:** The new finders should provide equivalent functionality for all `findGroundBrush()`, `findWallBrush()`, `findDoodadBrush()`, etc., methods that were on `Tile` by allowing searches for items with specific `ItemType`s or properties characteristic of those brush types.
    - **Usage in `Map` Operations:** Integrate these finders for operations like `Map::cleanDuplicateItems()` or `Map::cleanInvalidItems()`. These map methods would use the finders to get a list of items to process, then iterate that list for removal/transformation, potentially providing progress reporting if needed (original `foreach_*` functions sometimes did this).
    - **`transformItem`:** Port the logic for `transformItem` if it involved searching for items to replace with different ones (e.g., updating an item using `wxImage` based transformations is now Qt image transformations).
    - **Layer Considerations:** Ensure searches can be filtered by layer/floor if necessary.
    - **Property Caching vs. Recalculation:** Address the `wxwidgets` pattern where `Tile` often cached states (like `isPZ()`) to avoid recalculating from item lists. If `ItemFinder` is efficient, such caching might be less necessary, or `Tile` can use these finders internally to update its cached state when its items change. For rendering, `Tile` properties (`Tile::hasGround()`, `Tile::isWall()`) might still be direct checks, but their state is determined by the items the finders would locate.
    - **OTBM Interaction:** Consider how new OTBM reader/parser (Task 51/60) uses or could use these finders if items are placed and then properties are derived (e.g., after placing all items on a tile from OTBM, run a check using finders to set complex tile flags).
    - **General Structure:** Create these finders in a way that makes sense for `Tile` and its draw/property helper functions, perhaps replacing internal `Tile::get*Brush()` type checks if those determined draw logic; now, item properties or `ItemType` directly drive rendering, and finders help query these.
    - **`Task59.md` should list all significant search/find methods from `wxwidgets` `Tile` and `Map` classes, their criteria, and how they were used (e.g., for `cleanDuplicateItems`, `transformItem`, rendering logic based on item presence like `getItemRenderLayer`), to ensure full functional coverage by the new `ItemFinder`/`TileFinder` utilities.**
