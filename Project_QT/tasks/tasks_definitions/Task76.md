**Task76: Finish Graphics/Sprite/Rendering Integration (Layer Support, Special Item Flags, OpenGL Replacements, `drawBrushIndicator`)**
- Task: **Perform a final pass on all graphics, sprite, and rendering integration. This includes ensuring proper layer support for all rendered elements, handling any special `Item` flags that affect rendering and weren't covered, replacing any remaining OpenGL calls, and correctly implementing `drawBrushIndicator` using the new Qt rendering system.**
    - **Analyze Existing Rendering:** Review the complete rendering pipeline in `Project_QT/src` from `MapView` down to `Item::draw()`.
    - **Proper Layer Support:** Ensure items, creatures, effects, and overlays are rendered in the correct Z-order according to their defined layers or drawing priorities. This involves:
        -   Correct sorting in `Tile::draw()` if items within a tile have different sub-layers.
        -   Correct Z-valuing of `QGraphicsItem`s in `MapScene` if using them for complex layering.
        -   Handling of `DrawingOptions` related to layer visibility and transparency.
    - **Special `Item` Flag Rendering:** Identify and implement rendering for any remaining special `Item` flags that have a visual effect but were not explicitly handled in previous tasks (e.g., selection state highlights on specific item types if they draw differently when selected, as opposed to a generic `MapTileItem` highlight). This requires `Item::draw()` to check its flags and modify its `QPainter` output accordingly.
    - **Final OpenGL Replacement:** Meticulously find and replace *all* remaining direct OpenGL calls from `wxwidgets` (e.g., from `LightDrawer` for lighting effects, or any custom screen capture `TakeScreenshot` if it used `glReadPixels`) with Qt-style equivalents:
        -   Use `QPainter` for 2D effects.
        -   For screen capture: `QWidget::render(&pixmap)` or `QScreen::grabWindow()`.
        -   For complex lighting, investigate `QGraphicsEffect` or advanced `QPainter` composition modes; if pure OpenGL is unavoidable for a specific advanced effect, ensure it's correctly encapsulated within a `QOpenGLWidget` context.
    - **`drawBrushIndicator` Update:** Ensure the `MapView`'s `drawBrushIndicator()` (or equivalent logic for drawing the brush preview) is fully updated to use Qt drawing methods (`QPainter`). It should accurately reflect the current brush's shape, size, and potential effect area, using data from `BrushManager` and the active `Brush`. This builds upon Task 65.
    - **State Synchronization for `Map::LoadVersion` / `create`:** Ensure that if map loading (`Map::LoadVersion`) or item creation uses information or states from the current brush (e.g., from palettes' selected brush data), these are correctly passed and used by the Qt-specific item drawing methods (`Item::hasAttribute`, `TileMapFlags`, etc.) during display setup.
    - **Rendering Context (Cursor, Highlights):** Confirm that special drawing states, like rendering a differently sized cursor for tile/house selection, or highlighting based on `Item` properties or `BrushCategory` (e.g., wall hooks), are now handled by the new item rendering or `MapView` overlay drawing logic, especially if these no longer have a distinct item but rely on `DrawingOptions` defining tile/item or border types.
    - **`Task76.md` is crucial for identifying any obscure OpenGL calls, specific item flag rendering behaviors, complex layering rules from `wxwidgets`, and the detailed visual requirements for `drawBrushIndicator` under various brush states and types.**
