**Task84: Implement Map Loaders and Converters (Full BinaryFile I/O Replacement, All Formats, Version Conversions)**
- Task: **Migrate the actual `Map` format reading and writing from `wxwidgets BinaryFile` (or other low-level file I/O classes) to Qt's I/O system (`QFile`, `QDataStream`) for *all known map file types* the original editor supported. This includes their specific format conversion functions if the editor could convert between map versions or types. Ensure full `Map`/`Tile` structure restoration, including creation of waypoints, missing items, and correct `MapCanvas` item state updates.**
    - **Analyze Existing Map I/O:** Review any file I/O, map parsing, or conversion code in `Project_QT/src`.
    - **Replace `BinaryFile` with Qt I/O:** All low-level file reading/writing previously done with `wxwidgets BinaryFile` (or similar custom classes) must be replaced by `QFile` for opening/closing files and `QDataStream` for reading/writing binary data (ensuring correct byte order, string encoding, etc.).
    - **Support All Known Formats:** Implement loader/saver logic for every map file format the original editor supported (e.g., various OTBM versions, potentially older OTM, custom XML/binary formats if any). This may involve creating separate parser/serializer classes for each format, all callable from `Map::open()` and `Map::save()`.
    - **Format Identification:** Implement logic (e.g., in `Map::open()` or a helper utility) to identify the map format on open, potentially using file name extensions (from `FileName` class or `g_settings`) or by inspecting file headers/signatures.
    - **Version Conversion Logic:** If the `wxwidgets` editor supported converting maps between different client versions or sub-formats (e.g., upgrading an old OTBM to a newer structure, or changing item IDs based on version):
        -   Port this conversion logic meticulously. This might involve transformation tables for item IDs, attribute remapping, or structural changes to map data.
        -   This conversion might happen during loading an old format, or as an explicit "Convert Map" tool.
    - **Full Structure Restoration:** When loading a map:
        -   Ensure the correct `Map`/`Tile` structure is fully recreated.
        -   All `Item`s, `Creature`s, `House`s, `Town`s, `Waypoint`s, `Spawn`s are correctly instantiated with all their properties and added to the `Map`. This includes handling creation of any missing default items (e.g., ground tiles if the format was sparse) if the original editor did this.
    - **`MapCanvas` / `MapView` State Update:** After a map is loaded or converted, `MapView` and `MapScene` must be fully updated to display the new map correctly. All `QGraphicsItem`s representing map elements must be created or updated. The `MapView` viewport should be reset or centered appropriately.
    - **Tile-Specific IO (`setCollision`, `TileFlags`):** Correctly translate logic from `wxwidgets tile.h/tile.cpp` that handled specific IO operations or property settings during map load/save, such as `setCollision` or other `TileFlags`. These are now handled by setting attributes on the Qt `Tile` object, which are then persisted as part of OTBM or other format saving.
    - **Interactions with Brush Initialization:** If loading a map required specific brushes to be initialized or configured based on map content (e.g., if the `Map` itself held information from brush palette data in `wxwidgets`), ensure this initial state is correctly set up in `Project_QT` using the new brush system after map load. `MapCanvas` `MapView` items state for drawing for tiles no longer relies on `Selection` adding any kind of updates if only tiles within bounding box are affected via `addPositions/setRangeForXXX` now, it's direct from loaded data.
    - **`Task84.md` must provide a complete list of all map formats supported by `wxwidgets`, details on their file structures (especially for non-OTBM), specifics of any `BinaryFile` utility functions used, the full logic for version conversion between formats, and how tile flags or collision data were read/written at a low level.**
